/*! Script.js 1.0.0.0
 * 
 */
require(["ss","d3","Facebook","jquery"],function(n,t,i,$){function f(){}function u(){this.$0=0,this.$1=0,this.$2={},this.$3=$.Deferred()}function o(){}function r(){}function h(n,t){this.index=0,this.name=n.name,this.id=n.id,this.index=t,this.links=[]}var a=this,e,s,c,l;u.spitFriendsList=function(n){var u=50,r=[],t=[],i=0;return $.each(n,function(n,f){i>=u&&(r.push(t),t=[],i=0),t[i]=f,i++}),r.push(t),r},e={runQuery:function(t){var e,i,o,s,r,h,f;for(this.$0=this.$1=0,this.$2=t,e=u.spitFriendsList(t),i=0;i<e.length;i++){for(o=e[i],s=new Array(50),r=0;r<o.length;r++)h={method:"GET",relative_url:"me/mutualfriends/"+o[i].id},s[r]=h;f={},f.batch=s,f.include_headers=!1,FB.api("/","POST",f,n.bind("$4",this)),this.$0++}return this.$3.promise()},$4:function(n){this.$1++;var t=$.parseJSON(n[0].body.toString());this.$1===this.$0&&window.alert("alldone")}},s={runQuery:function(n){var i=$.Deferred(),r={},t;return r.friendsAll="SELECT uid1, uid2 from friend WHERE uid1 = me()",r.friendsoffriends="SELECT uid1, uid2 FROM friend WHERE uid1 IN (SELECT uid2 from #friendsAll) AND uid2 IN (SELECT uid2 from #friendsAll) AND uid1 < uid2",t={},t.method="fql.multiquery",t.queries=r,FB.api(t,function(t){var r;if(!!t[0]){for(r=0;r<t[1].fql_result_set.length;r++){var u=t[1].fql_result_set[r],f=n[u.uid1],e=n[u.uid2];e.links.push(f.id),f.links.push(e.id)}i.rejectWith(n)}else i.reject()}),i.promise()}},r.$9=function(){var n={};n.scope="email",FB.login(function(){},n)},r.$a=function(){var n=$("#charge").val(),t=$("#distance").val();r.$b(null)},r.$b=function(){var t=n.now();$("#canvas").empty();var i=[],u=[];FB.api("/me/friends",function(n){!n.error?r.$c(t,i,u,n):$("body").append("Error: "+n.error.message)})},r.$c=function(n,t,i,f){for(var o,s,e=0;e<f.data.length;e++)o=new h(f.data[e],e),r.$1[o.id]=o,s={},s.name=o.name,s.group=1,s.id=o.id,t[t.length]=s;$.when(r.$8.runQuery(r.$1)).then(function(u){r.$1=u,r.$d(n,t,i)},function(){r.$8=new u,$.when(r.$8.runQuery(r.$1)).then(function(){},function(){})})},r.$d=function(t,i,u){var f=n.now(),e=t.getMilliseconds()-f.getMilliseconds();$("body").append("query took: "+e/1e3),r.$e(i,u)},r.$e=function(n,i){var f=960,e=800,u;$.each(r.$1,function(n,t){for(var u=t,s=parseInt(u.id),o,e,f=0;f<u.links.length;f++)o=parseInt(u.links[f]),s<o&&(e={},e.source=u.index,e.target=r.$1[u.links[f]].index,e.value=1,i[i.length]=e)}),r.$5=t.behavior.zoom().scaleExtent([.4,4]).on("zoom",r.$g),u=t.layout.force().charge(-120).linkDistance(80).size([f,e]),r.$6=t.select("#canvas").append("svg").attr("width",f).attr("height",e).call(r.$5).append("g"),u.nodes(n).links(i).start(),r.$3=r.$6.selectAll(".link").data(i).enter().append("line").attr("class","link").style("stroke-width",function(n){return Math.sqrt(n.value)}),r.$4=r.$6.selectAll(".node").data(n).enter().append("circle").attr("class","node").attr("r",7).call(u.drag).on("mousemove",r.$i).on("mouseover",r.$j).on("mouseout",r.$k).on("click",r.$f),r.$4.append("title").text(function(n){return n.name});u.on("tick",r.$h)},r.$f=function(n){r.$2=n.id===r.$2?null:n.id,r.$h()},r.$g=function(){r.$6.attr("transform","translate("+t.event.translate+")scale("+t.event.scale+")")},r.$h=function(){r.$3.attr("x1",function(n){return n.source.x}).attr("y1",function(n){return n.source.y}).attr("x2",function(n){return n.target.x}).attr("y2",function(n){return n.target.y}).style("stroke-width",function(n){return!!r.$2&&r.$l(n,r.$2)?2:1}),r.$4.attr("cx",function(n){return n.x}).attr("cy",function(n){return n.y}).attr("fill",function(n){return!!r.$2?r.$1[r.$2].links.indexOf(n.id)>=0?"red":n.id===r.$2?"green":"black":"black"})},r.$i=function(){t.event.stopPropagation();var n=$("#callout")},r.$j=function(i){var r,u;t.event.stopPropagation(),r=$("#callout"),r.show(),u="<p><img src='http://graph.facebook.com/{0}/picture' alt='{1}' height='100' width='100'><\/p><p>{1}<\/p>",r.html(n.format(u,i.id,i.name))},r.$k=function(){t.event.stopPropagation();var n=$("#callout");n.hide()},r.$l=function(n,t){return n.source.id===t||n.target.id===t},r.$m=function(){FB.logout(function(){})},r.$n=function(){$("#login").click(r.$9),$("#graph").click(r.$a);var n={};n.appId="459808530803920",n.channelUrl="http://jsff.asurewebsites.com/channel.aspx",n.status=!0,n.cookie=!0,n.xfbml=!1,FB.init(n),FB.getLoginStatus(function(n){n.status==="connected"&&(r.$0=n.authResponse.userID)}),FB.Event.subscribe("auth.authResponseChange",function(n){n.status==="connected"&&(r.$0=n.authResponse.userID)})},c={},l=n.module("Script",{IQueryEngine:[f],FFJS:[r,null,null]},{BatchQuery:[u,e,null,f],FQLQuery:[o,s,null,f],Friend:[h,c,null]}),r.$1={},r.$2=null,r.$7=!0,r.$8=new o,$(r.$n)})